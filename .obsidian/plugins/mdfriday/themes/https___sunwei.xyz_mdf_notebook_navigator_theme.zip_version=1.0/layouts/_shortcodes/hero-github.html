{{ $label := .Get "label" }}
{{ $repo := .Get "repo" }}
{{ $fallbackValue := .Get "fallback" | default "400" }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const heroStats = document.getElementById('hero-stats');
    if (heroStats) {
        // Add divider if not first stat
        if (heroStats.children.length > 0) {
            const divider = document.createElement('div');
            divider.className = 'stat-divider';
            heroStats.appendChild(divider);
        }
        
        const stat = document.createElement('div');
        stat.className = 'stat';
        
        const value = document.createElement('span');
        value.className = 'stat-value';
        value.id = 'github-stars-count';
        value.textContent = '{{ $fallbackValue }}'; // Initial fallback value
        
        const label = document.createElement('span');
        label.className = 'stat-label';
        label.textContent = '{{ $label }}';
        
        stat.appendChild(value);
        stat.appendChild(label);
        heroStats.appendChild(stat);
        
        // Fetch GitHub stars (based on source implementation)
        fetchGitHubStars();
    }
});

async function fetchGitHubStars() {
    try {
        const response = await fetch('https://api.github.com/repos/{{ $repo }}');
        const data = await response.json();
        const stars = data.stargazers_count;
        
        if (stars) {
            const formattedStars = formatNumber(stars);
            const starsElement = document.getElementById('github-stars-count');
            if (starsElement) {
                starsElement.setAttribute('data-value', formattedStars);
                starsElement.textContent = formattedStars;
            }
            
            // Also update any other elements with these IDs (for compatibility)
            const otherElements = document.querySelectorAll('#star-count, #github-stars');
            otherElements.forEach(el => {
                if (el) {
                    el.textContent = stars > 999 ? (stars / 1000).toFixed(1) + 'k' : stars.toString();
                }
            });
            
            console.log('GitHub stars loaded successfully:', stars);
        }
    } catch (error) {
        console.log('Failed to load GitHub stars:', error);
        // Keep fallback value
    }
}

function formatNumber(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(num >= 10000 ? 0 : 1) + 'k';
    }
    return num.toString();
}
</script>
